# ESP8266_Clock

使用esp8266驱动TIM1628驱动6个数码管显示时间


- ds3231时间 	
- 光敏电阻自动配置亮度/手动设置亮度
- ~~水银开关自动配置数码管方向~~
- wifi连接失败20次后等待1分钟后重试
- SmartConfig配置wifi
- 每小时整点自动网络校时
- 日期时间交替显示



## 通讯协议

wifi通信使用UDP通信协议,发送十六进制值

### APP发送给ESP8266

格式如下(每个为一个字节):

> A5 5A Length MAC CMD DATA1 DATA2 DATA3.... DATAn....

其中 `A5 5A`包头,表示数据开始

`Length`为数据总长度,包含包头长度及MAC CMD DATA;1字节

`MAC`为ESP8266设备MAC地址最后8位,当为FF时,为所有接收到的设备; 1字节

`CMD`为命令含义,见下表;1字节

`DATA1-DATAn`为命令对应数据,可以为n个字节,n可以为0;(由于Length为8bit,所以DATA最长为255-5=250字节长度)



| CMD命令(十六进制) | DATA                                                         | 说明                                                         |
| :---------------: | :----------------------------------------------------------- | :----------------------------------------------------------- |
|        00         | 无                                                           | 回应设备MAC地址及IP地址                                      |
|        01         | DATA1:亮度                                                   | 设置亮度/自动亮度;<br />0-7:设置亮度,<br />8:自动亮度<br />FF:查询当前亮度 |
|        02         | DATA1:闹钟总开关                                             | 1:开<br />0:关<br />FF:查询                                  |
|        03         | DATA1:闹钟编号<br />DATA2:闹钟开关<br />DATA3:闹钟重复设置<br />DATA4:闹钟时<br />DATA5:闹钟分 | 设置闹钟<br />无DATA时为查询所有闹钟设置<br />只有DATA1时为查询对应编号闹钟设置 |



### ESP8266发送给APP

格式与app发送给ESP8266相同,格式如下(每个为一个字节):

> A5 5A Length MAC CMD DATA1 DATA2 DATA3.... DATAn....

其中 `A5 5A`包头,表示数据开始

`Length`为数据总长度,包含包头长度及MAC CMD DATA;1字节

`MAC`为ESP8266设备MAC地址最后8位,当为FF时,为所有接收到的设备; 1字节

`CMD`为命令含义,与app发送给ESP8266相同,见下表;1字节

`DATA1-DATAn`为命令对应数据,可以为n个字节,n可以为0;(由于Length为8bit,所以DATA最长为255-5=250字节长度)



| CMD命令(十六进制) | DATA                                                         | 说明                                                        |
| :---------------: | :----------------------------------------------------------- | :---------------------------------------------------------- |
|        00         | DATA1-DATA6:ESP8266MAC地址<br />DATA7-DATA10:ESP8266 IP地址  | 回应设备MAC地址及IP地址                                     |
|        01         | DATA1:亮度                                                   | 当前亮度/自动亮度;<br />0-7:设置亮度,<br />8:自动亮度<br /> |
|        02         | DATA1:闹钟总开关                                             | 1:开<br />0:关<br />FF:查询                                 |
|        03         | DATA1:闹钟编号<br />DATA2:闹钟开关<br />DATA3:闹钟重复设置<br />DATA4:闹钟时<br />DATA5:闹钟分 | 查询闹钟                                                    |

